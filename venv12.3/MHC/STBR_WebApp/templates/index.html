<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STBR Analysis & Portfolio Rotation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Include Plotly.js -->
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
    <!-- Remove Chart.js -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script> -->
</head>
<body>
    <h1>Short Term Bubble Risk (STBR) Analysis</h1>

    <form id="stbr-form">
        <div class="input-group">
            <label for="asset_type">Asset Type:</label>
            <select id="asset_type" name="asset_type">
                <option value="crypto">Crypto</option>
                <option value="stock">Stock</option>
                <option value="cash">Cash</option>
            </select>
        </div>

        <div class="input-group ticker-group">
            <label for="symbol">Ticker Symbol:</label>
            <input type="text" id="symbol" name="symbol" value="BTC" required autocomplete="off">
            <div id="search-results"></div>
        </div>

        <button type="submit">Analyze Ticker</button>
    </form>

    <div id="status-message"></div>
    <div id="plotly-chart"> <!-- Use original div ID -->
        <!-- Plotly chart will be inserted here -->
    </div>

    <hr>

    <h2>Portfolio Rotation Analysis</h2>

    <div id="portfolio-input-section">
        <h3>Enter Your Holdings:</h3>
        <div id="holdings-list">
            <!-- Holding input rows will be added here by JS -->
            <div class="holding-row">
                <!-- NEW: Wrap each input group -->
                <div class="holding-asset-type-group">
                    <label>Type</label> <!-- Added label -->
                    <select class="holding-asset-type">
                        <option value="crypto">Crypto</option>
                        <option value="stock">Stock</option>
                        <option value="cash">Cash</option>
                    </select>
                </div>
                <div class="holding-ticker-group">
                     <label>Ticker</label> <!-- Added label -->
                    <input type="text" class="holding-ticker" placeholder="Ticker (e.g., BTC, AAPL, CASH)" required>
                </div>
                <div class="holding-shares-group">
                     <label>Shares/Amount</label> <!-- Added label -->
                    <input type="number" class="holding-shares" placeholder="Shares / Amount ($)" step="any" min="0" required>
                </div>
                <!-- Remove button remains outside the groups -->
                <button type="button" class="remove-holding">Remove</button>
            </div>
        </div>
        <button type="button" id="add-holding">Add Holding</button>
        <button type="button" id="analyze-portfolio-btn">Analyze Portfolio</button>
    </div>

    <div id="portfolio-status-message"></div>
    <div id="portfolio-results-section" style="display: none;">
        <h3>Portfolio Summary</h3>
        <p>Total Portfolio Value: $<span id="total-portfolio-value">0.00</span></p>
        <p>Potential Value to Rotate to Cash (Assets marked "Rotate Out"): $<span id="rotate-out-value">0.00</span></p>
        
        <div id="portfolio-plotly-chart"> <!-- Use original div ID -->
            <!-- Portfolio Plotly chart will be inserted here -->
        </div>

        <h4>Detailed Holdings:</h4>
        <table id="portfolio-table">
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Type</th>
                    <th>Shares / Amount</th>
                    <th>Latest Price ($)</th>
                    <th>Holding Value ($)</th>
                    <th>Latest STBR</th>
                    <th>STBR Category</th>
                    <th>Signal</th>
                    <th>Error</th>
                </tr>
            </thead>
            <tbody id="portfolio-table-body">
                <!-- Portfolio analysis results will be inserted here by JS -->
            </tbody>
        </table>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
